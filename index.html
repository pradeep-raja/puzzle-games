<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Diamond Hunt</title>
<style>
  body { font-family: sans-serif; text-align: center; background: #fafafa; }
  table { border-collapse: collapse; margin: 20px auto; }
  td {
    width: 50px; height: 50px;
    border: 1px solid #ccc;
    text-align: center;
    font-size: 20px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.2s;
    position: relative;
  }
  td:hover { background-color: #e0f7fa; }
  td.clicked { background-color: #dcedc8; }
  td.no-clue { background-color: #ffe5e5; }
  td.hit { background-color: gold; animation: diamondFound 0.6s ease-out; }
  @keyframes diamondFound {
    0% { transform: scale(0); opacity: 0; }
    60% { transform: scale(1.3); opacity: 1; }
    100% { transform: scale(1); }
  }

  /* Sparkle effect */
  .sparkle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: white;
    border-radius: 50%;
    animation: sparkleMove 0.8s ease-out forwards;
    pointer-events: none;
  }
  @keyframes sparkleMove {
    0% { transform: translate(0,0) scale(1); opacity: 1; }
    100% { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; }
  }

  #message { margin-top: 15px; font-weight: bold; }
  #controls { margin-top: 20px; }
  button { padding: 8px 15px; font-size: 16px; cursor: pointer; }
</style>
</head>
<body>

<h1>ðŸ’Ž Diamond Hunt</h1>
<div id="message">Click a cell to start hunting!</div>
<div id="clicks">Clicks: 0</div>
<table id="board"></table>
<div id="controls">
  <button onclick="newGame()">New Game</button>
</div>

<script>
const N = 5;
let clicks, candidates, fixedDiamond;

function initGame() {
  clicks = 0;
  fixedDiamond = null;
  candidates = new Set();
  for (let r = 0; r < N; r++) {
    for (let c = 0; c < N; c++) {
      candidates.add(key(r, c));
    }
  }
  document.getElementById('clicks').textContent = `Clicks: ${clicks}`;
  setMessage('Click a cell to start hunting!');
  createBoard();
}

function newGame() {
  initGame();
}

const key = (r, c) => `${r},${c}`;
const parseKey = k => { const [r, c] = k.split(',').map(Number); return {r, c}; };

function createBoard() {
  const board = document.getElementById('board');
  board.innerHTML = '';
  for (let r = 0; r < N; r++) {
    const row = document.createElement('tr');
    for (let c = 0; c < N; c++) {
      const cell = document.createElement('td');
      cell.dataset.r = r;
      cell.dataset.c = c;
      cell.addEventListener('click', () => onCellClick(r, c, cell));
      row.appendChild(cell);
    }
    board.appendChild(row);
  }
}

function setCellNumber(r, c, value, cls) {
  const cell = document.querySelector(`td[data-r="${r}"][data-c="${c}"]`);
  if (!cell) return;
  cell.textContent = value;
  if (cls) cell.classList.add(cls);
}

function distance(a, b) {
  return Math.abs(a.r - b.r) + Math.abs(a.c - b.c);
}

function farthestDistanceFrom(cell) {
  let max = 0;
  for (let r = 0; r < N; r++) {
    for (let c = 0; c < N; c++) {
      max = Math.max(max, distance(cell, {r, c}));
    }
  }
  return max;
}

function cellsAtDistanceFrom(cell, dist, pool) {
  const res = [];
  for (let k of pool) {
    const p = parseKey(k);
    if (distance(cell, p) === dist) res.push(k);
  }
  return res;
}

function spawnSparkles(cell) {
  const numSparkles = 10;
  for (let i = 0; i < numSparkles; i++) {
    const sparkle = document.createElement('div');
    sparkle.className = 'sparkle';
    const angle = Math.random() * Math.PI * 2;
    const dist = 20 + Math.random() * 15;
    sparkle.style.setProperty('--dx', `${Math.cos(angle) * dist}px`);
    sparkle.style.setProperty('--dy', `${Math.sin(angle) * dist}px`);
    cell.appendChild(sparkle);
    setTimeout(() => sparkle.remove(), 800);
  }
}

function onCellClick(r, c, cellEl) {
  clicks++;
  document.getElementById('clicks').textContent = `Clicks: ${clicks}`;
  
  const currentCell = {r, c};

  if (fixedDiamond) {
    const d = distance(currentCell, fixedDiamond);
    if (d === 0) {
      setCellNumber(r, c, 'ðŸ’Ž', 'hit');
      spawnSparkles(cellEl);
      setMessage(`ðŸŽ‰ You found the diamond in ${clicks} clicks!`);
    } else {
      cellEl.textContent = d;
      cellEl.classList.add('clicked');
    }
    return;
  }

  const max = farthestDistanceFrom(currentCell);
  const feasible = [];
  for (let d = 3; d <= max; d++) {
    const inter = cellsAtDistanceFrom(currentCell, d, candidates);
    if (inter.length > 0) feasible.push(d);
  }

  if (feasible.length === 0) {
    setCellNumber(r, c, 'ðŸš«', 'no-clue');
    setMessage(`No clue possible from (${r+1},${c+1}) ðŸš«`);
    return;
  }

  const chosenDist = feasible[Math.floor(Math.random() * feasible.length)];
  const possibleCells = cellsAtDistanceFrom(currentCell, chosenDist, candidates);

  cellEl.textContent = chosenDist;
  cellEl.classList.add('clicked');

  candidates = new Set(possibleCells);

  if (candidates.size === 1) {
    fixedDiamond = parseKey([...candidates][0]);
    setMessage(`Diamond fixed at (${fixedDiamond.r+1},${fixedDiamond.c+1}). You can find it in your next click! ðŸŽ¯`);
  } else {
    setMessage(`Diamond is exactly ${chosenDist} steps away from (${r+1},${c+1})`);
  }
}

function setMessage(msg) {
  document.getElementById('message').textContent = msg;
}

initGame();
</script>
</body>
</html>
