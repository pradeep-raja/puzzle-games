<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Grid Quest</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    background: linear-gradient(135deg, #fdfcfb, #e2d1c3);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }

  h1 {
    margin: 10px 0;
    font-size: 2.2em;
    color: #6b4f2a;
    text-shadow: 1px 1px 0 #fff;
  }

  .game-container {
    background: #fff8e7;
    border-radius: 15px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    padding: 20px 30px;
    text-align: center;
    max-width: 500px;
    width: 100%;
  }

  #message {
    background: #f4e1b6;
    padding: 10px 15px;
    border-radius: 8px;
    margin: 10px 0;
    min-height: 24px;
    font-weight: bold;
    color: #5a3e1b;
  }

  #clicks {
    font-weight: bold;
    margin: 5px 0 15px;
  }

  table {
    border-spacing: 5px;
    margin: 0 auto 15px;
  }

  td {
    width: 60px;
    height: 60px;
    background: linear-gradient(145deg, #fff, #ddd);
    border-radius: 12px;
    text-align: center;
    font-size: 1.4em;
    font-weight: bold;
    color: #333;
    cursor: pointer;
    transition: transform 0.15s, background 0.15s, box-shadow 0.15s;
    box-shadow: 2px 2px 6px rgba(0,0,0,0.15);
    position: relative;
  }

  td:hover {
    transform: scale(1.05);
    background: linear-gradient(145deg, #f7f7f7, #e3e3e3);
    box-shadow: 3px 3px 8px rgba(0,0,0,0.2);
  }

  td.clicked {
    background: linear-gradient(145deg, #d4edda, #c3e6cb);
    color: #155724;
  }

  td.no-clue {
    background: linear-gradient(145deg, #f8d7da, #f5c6cb);
    color: #721c24;
  }

  td.hit {
    background: linear-gradient(145deg, gold, #fdd835);
    color: white;
    animation: diamondFound 0.6s ease-out;
  }

  @keyframes diamondFound {
    0% { transform: scale(0); opacity: 0; }
    60% { transform: scale(1.3); opacity: 1; }
    100% { transform: scale(1); }
  }

  button {
    padding: 10px 20px;
    background: #6b4f2a;
    color: white;
    font-size: 1em;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
    transition: background 0.2s;
  }

  button:hover {
    background: #8c6b3a;
  }

  /* Sparkle animation */
  .sparkle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: white;
    border-radius: 50%;
    animation: sparkleMove 0.8s ease-out forwards;
    pointer-events: none;
  }

  @keyframes sparkleMove {
    0% { transform: translate(0,0) scale(1); opacity: 1; }
    100% { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; }
  }
</style>
</head>
<body>

<h1>ðŸ’Ž Grid Quest</h1>
<div class="game-container">
  <div id="message">Click a cell to start your quest!</div>
  <div id="clicks">Moves: 0</div>
  <table id="board"></table>
  <button onclick="newGame()">New Game</button>
</div>

<script>
const N = 5;
let clicks, candidates, fixedDiamond;

function initGame() {
  clicks = 0;
  fixedDiamond = null;
  candidates = new Set();
  for (let r = 0; r < N; r++) {
    for (let c = 0; c < N; c++) {
      candidates.add(key(r, c));
    }
  }
  document.getElementById('clicks').textContent = `Moves: ${clicks}`;
  setMessage('Click a cell to start your quest!');
  createBoard();
}

function newGame() {
  initGame();
}

const key = (r, c) => `${r},${c}`;
const parseKey = k => { const [r, c] = k.split(',').map(Number); return {r, c}; };

function createBoard() {
  const board = document.getElementById('board');
  board.innerHTML = '';
  for (let r = 0; r < N; r++) {
    const row = document.createElement('tr');
    for (let c = 0; c < N; c++) {
      const cell = document.createElement('td');
      cell.dataset.r = r;
      cell.dataset.c = c;
      cell.addEventListener('click', () => onCellClick(r, c, cell));
      row.appendChild(cell);
    }
    board.appendChild(row);
  }
}

function setCellNumber(r, c, value, cls) {
  const cell = document.querySelector(`td[data-r="${r}"][data-c="${c}"]`);
  if (!cell) return;
  cell.textContent = value;
  if (cls) {
    cell.classList.remove('no-clue', 'clicked', 'hit');
    cell.classList.add(cls);
  }
}

function distance(a, b) {
  return Math.abs(a.r - b.r) + Math.abs(a.c - b.c);
}

function farthestDistanceFrom(cell) {
  let max = 0;
  for (let r = 0; r < N; r++) {
    for (let c = 0; c < N; c++) {
      max = Math.max(max, distance(cell, {r, c}));
    }
  }
  return max;
}

function cellsAtDistanceFrom(cell, dist, pool) {
  const res = [];
  for (let k of pool) {
    const p = parseKey(k);
    if (distance(cell, p) === dist) res.push(k);
  }
  return res;
}

function spawnSparkles(cell) {
  const numSparkles = 12;
  for (let i = 0; i < numSparkles; i++) {
    const sparkle = document.createElement('div');
    sparkle.className = 'sparkle';
    const angle = Math.random() * Math.PI * 2;
    const dist = 25 + Math.random() * 20;
    sparkle.style.setProperty('--dx', `${Math.cos(angle) * dist}px`);
    sparkle.style.setProperty('--dy', `${Math.sin(angle) * dist}px`);
    cell.appendChild(sparkle);
    setTimeout(() => sparkle.remove(), 800);
  }
}

function onCellClick(r, c, cellEl) {
  // Clear old no-clue icons
  document.querySelectorAll('td.no-clue').forEach(td => {
    td.textContent = '';
    td.classList.remove('no-clue');
  });

  clicks++;
  document.getElementById('clicks').textContent = `Moves: ${clicks}`;
  
  const currentCell = {r, c};

  if (fixedDiamond) {
    const d = distance(currentCell, fixedDiamond);
    if (d === 0) {
      setCellNumber(r, c, 'ðŸ’Ž', 'hit');
      spawnSparkles(cellEl);
      setMessage(`ðŸŽ‰ Quest complete! You found the diamond in ${clicks} moves!`);
    } else {
      setCellNumber(r, c, d, 'clicked');
    }
    return;
  }

  const max = farthestDistanceFrom(currentCell);
  const feasible = [];
  for (let d = 3; d <= max; d++) {
    const inter = cellsAtDistanceFrom(currentCell, d, candidates);
    if (inter.length > 0) feasible.push(d);
  }

  if (feasible.length === 0) {
    setCellNumber(r, c, 'ðŸš«', 'no-clue');
    setMessage(`No clue possible from (${r+1},${c+1}) ðŸš«`);
    return;
  }

  const chosenDist = feasible[Math.floor(Math.random() * feasible.length)];
  const possibleCells = cellsAtDistanceFrom(currentCell, chosenDist, candidates);

  setCellNumber(r, c, chosenDist, 'clicked');
  candidates = new Set(possibleCells);

  if (candidates.size === 1) {
    fixedDiamond = parseKey([...candidates][0]);
    setMessage(`ðŸ’¡ The diamondâ€™s location is known! You can find it in your next move! ðŸŽ¯`);
  } else {
    setMessage(`The diamond is exactly ${chosenDist} steps away from (${r+1},${c+1})`);
  }
}

function setMessage(msg) {
  document.getElementById('message').textContent = msg;
}

initGame();
</script>
</body>
</html>
